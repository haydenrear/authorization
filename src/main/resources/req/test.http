
# @no-cookie-jar
POST http://localhost:8081/login/oauth/access_token

### GET request to example server
# @no-cookie-jar
GET http://localhost:8080/userinfo
Authorization: Bearer eyJraWQiOiI2ZWI3ZjZhYS02ODcyLTQxOGItYjE1NS04M2JlNmM5NjE4MjQiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI0NDA3Njc0NyIsImdpc3RzX3VybCI6Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlcnMvaGF5ZGVucmVhci9naXN0c3svZ2lzdF9pZH0iLCJyZXBvc191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvcmVwb3MiLCJ1c2VyX3ZpZXdfdHlwZSI6InByaXZhdGUiLCJ0d29fZmFjdG9yX2F1dGhlbnRpY2F0aW9uIjp0cnVlLCJmb2xsb3dpbmdfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL2ZvbGxvd2luZ3svb3RoZXJfdXNlcn0iLCJpc3MiOiJsb2NhbGhvc3Q6ODA4MCIsImJpbyI6ImhlbGxvIiwiY3JlYXRlZF9hdCI6IjIwMTgtMTAtMTJUMDE6MzE6MDZaIiwiYmxvZyI6IiIsInR5cGUiOiJVc2VyIiwibG9naW4iOiJoYXlkZW5yZWFyIiwicHJpdmF0ZV9naXN0cyI6MSwidG90YWxfcHJpdmF0ZV9yZXBvcyI6NDEsInN1YnNjcmlwdGlvbnNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL3N1YnNjcmlwdGlvbnMiLCJ1cGRhdGVkX2F0IjoiMjAyNS0xMC0xM1QxNzoxOToyOFoiLCJzY29wZSI6WyJhZGRyZXNzIiwicGhvbmUiLCJvcGVuaWQiLCJyZWFkOnVzZXIiLCJwcm9maWxlIiwidXNlcjplbWFpbCIsInVzZXIiLCJlbWFpbCJdLCJzaXRlX2FkbWluIjpmYWxzZSwiZGlza191c2FnZSI6MjMxODM5LCJjb2xsYWJvcmF0b3JzIjoyLCJvd25lZF9wcml2YXRlX3JlcG9zIjo0MSwiaWQiOjQ0MDc2NzQ3LCJwdWJsaWNfcmVwb3MiOjc2LCJleHAiOjE3NjA5ODAyNDYsImlhdCI6MTc2MDk3OTk0NiwicGxhbiI6eyJuYW1lIjoiZnJlZSIsInNwYWNlIjo5NzY1NjI0OTksImNvbGxhYm9yYXRvcnMiOjAsInByaXZhdGVfcmVwb3MiOjEwMDAwfSwiZ3JhdmF0YXJfaWQiOiIiLCJqdGkiOiIwY2Y4NDFiMy1kZDVhLTQ1NjktOTM1My0wZDFkYmY2ODY5OTIiLCJvcmdhbml6YXRpb25zX3VybCI6Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlcnMvaGF5ZGVucmVhci9vcmdzIiwiaGlyZWFibGUiOnRydWUsInN0YXJyZWRfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL3N0YXJyZWR7L293bmVyfXsvcmVwb30iLCJmb2xsb3dlcnNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL2ZvbGxvd2VycyIsInB1YmxpY19naXN0cyI6MCwidXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyIiwiYXVkIjoiY2RjLW9hdXRoMi1jbGllbnQiLCJyZWNlaXZlZF9ldmVudHNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL3JlY2VpdmVkX2V2ZW50cyIsIm5iZiI6MTc2MDk3OTk0NiwiZm9sbG93ZXJzIjo4LCJhdmF0YXJfdXJsIjoiaHR0cHM6Ly9hdmF0YXJzLmdpdGh1YnVzZXJjb250ZW50LmNvbS91LzQ0MDc2NzQ3P3Y9NCIsImV2ZW50c191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvZXZlbnRzey9wcml2YWN5fSIsImh0bWxfdXJsIjoiaHR0cHM6Ly9naXRodWIuY29tL2hheWRlbnJlYXIiLCJmb2xsb3dpbmciOjE3LCJuYW1lIjoiSGF5ZGVuIFJlYXIiLCJsb2NhdGlvbiI6IkV1Z2VuZSwgT3JlZ29uIiwibm9kZV9pZCI6Ik1EUTZWWE5sY2pRME1EYzJOelEzIn0.LCR5IesA0nW_a5rdzgjej_N2Y0ec6dcjS7O8loU8czSWil1EHjICx3ui5p9BQzhZO7lanLo4zwljqSyj0vjbEHqaXVAwtQmegRtV3iTjflYBc3BLvaq4ppUwvg5Kq7Yq9zmUdeAcKgT5WA93FXw6EIS8av3XfM-l8tYB_FyzRBQJ92sh08TMirMvl_f2XJyWV9NYbSQ-gQgm-0qI33IXiUmqVd5P__0ykWQAgEj8104tLACpg3RRaK9q0av38L7WZqxtH_XGq4dW_VJYKAwlWKaRUGDZFPH9Zg3_QR3a_WIfuYlRG83guDhqT3SelQoXq4e62K7_I-t6XlMlRE3Oyw
Content-Type: application/x-www-form-urlencoded

grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&client_id=client&client_secret=secret

### GET request to example server
POST http://localhost:8080/oauth2/token
Authorization: Basic dXNlcjpwYXNzd29yZA==
Content-Type: application/x-www-form-urlencoded

grant_type=password&client_id=client&client_secret=secret

###

#< {%

 // var token = 'eyJraWQiOiIzMTFjZTViOC01ZWY4LTQ2ODQtOTc5Yi1hYTIyZWI4NWNmZmIiLCJhbGciOiJSUzI1NiJ9.eyJHSVRIVUJfbmFtZSI6IkhheWRlbiBSZWFyIiwic3ViIjoiaGF5ZGVucmVhciIsIkdJVEhVQl90b3RhbF9wcml2YXRlX3JlcG9zIjo0MSwiR0lUSFVCX3N0YXJyZWRfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL3N0YXJyZWR7L293bmVyfXsvcmVwb30iLCJHSVRIVUJfZm9sbG93ZXJzIjo4LCJHSVRIVUJfbm9kZV9pZCI6Ik1EUTZWWE5sY2pRME1EYzJOelEzIiwiR0lUSFVCX2h0bWxfdXJsIjoiaHR0cHM6Ly9naXRodWIuY29tL2hheWRlbnJlYXIiLCJHSVRIVUJfZm9sbG93aW5nIjoxNywiR0lUSFVCX3B1YmxpY19naXN0cyI6MCwiR0lUSFVCX2JpbyI6ImhlbGxvIiwiR0lUSFVCX2NvbGxhYm9yYXRvcnMiOjIsIkdJVEhVQl9pZCI6NDQwNzY3NDcsIkdJVEhVQl9mb2xsb3dpbmdfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL2ZvbGxvd2luZ3svb3RoZXJfdXNlcn0iLCJHSVRIVUJfaGlyZWFibGUiOnRydWUsInNjb3BlIjpbImFkZHJlc3MiLCJjbGllbnRJZCIsImNkYyIsInByZWZlcnJlZFVzZXJuYW1lIiwib3BlbmlkIiwicHJvZmlsZSIsInVzZXI6ZW1haWwiLCJwcmluY2lwYWxJZCIsInBob25lIiwicmVhZDp1c2VyIiwibmFtZSIsInVzZXIiLCJlbWFpbCIsInVzZXJuYW1lIl0sIkdJVEhVQl9vd25lZF9wcml2YXRlX3JlcG9zIjo0MSwiR0lUSFVCX2F2YXRhcl91cmwiOiJodHRwczovL2F2YXRhcnMuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3UvNDQwNzY3NDc_dj00IiwiR0lUSFVCX2V2ZW50c191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvZXZlbnRzey9wcml2YWN5fSIsIkdJVEhVQl9yZXBvc191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvcmVwb3MiLCJleHAiOjE3NjEwNjEwNzcsIkdJVEhVQl9ibG9nIjoiIiwiaWF0IjoxNzYxMDYwNzc3LCJqdGkiOiI5N2M5MWRhZC04ZjdhLTQ4ZjctYWYxNS1hNWE2NmFmMzMyODAiLCJHSVRIVUJfdHdvX2ZhY3Rvcl9hdXRoZW50aWNhdGlvbiI6dHJ1ZSwiR0lUSFVCX29yZ2FuaXphdGlvbnNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL29yZ3MiLCJHSVRIVUJfY3JlYXRlZF9hdCI6IjIwMTgtMTAtMTJUMDE6MzE6MDZaIiwiR0lUSFVCX2dyYXZhdGFyX2lkIjoiIiwiR0lUSFVCX3VzZXJfdmlld190eXBlIjoicHJpdmF0ZSIsIkdJVEhVQl9wbGFuIjp7Im5hbWUiOiJmcmVlIiwic3BhY2UiOjk3NjU2MjQ5OSwiY29sbGFib3JhdG9ycyI6MCwicHJpdmF0ZV9yZXBvcyI6MTAwMDB9LCJhdWQiOiJjZGMtb2F1dGgyLWNsaWVudCIsIkdJVEhVQl9sb2NhdGlvbiI6IkV1Z2VuZSwgT3JlZ29uIiwiR0lUSFVCX3B1YmxpY19yZXBvcyI6NzYsIm5iZiI6MTc2MTA2MDc3NywiR0lUSFVCX3VybCI6Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlcnMvaGF5ZGVucmVhciIsIkdJVEhVQl91cGRhdGVkX2F0IjoiMjAyNS0xMC0xM1QxNzoxOToyOFoiLCJHSVRIVUJfc3Vic2NyaXB0aW9uc191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvc3Vic2NyaXB0aW9ucyIsIkdJVEhVQl9yZWNlaXZlZF9ldmVudHNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL3JlY2VpdmVkX2V2ZW50cyIsIkdJVEhVQl9sb2dpbiI6ImhheWRlbnJlYXIiLCJHSVRIVUJfZ2lzdHNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL2dpc3Rzey9naXN0X2lkfSIsIkdJVEhVQl90eXBlIjoiVXNlciIsIkdJVEhVQl9kaXNrX3VzYWdlIjoyMzE4MzksIkdJVEhVQl9zaXRlX2FkbWluIjpmYWxzZSwiR0lUSFVCX2ZvbGxvd2Vyc191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvZm9sbG93ZXJzIiwiR0lUSFVCX3ByaXZhdGVfZ2lzdHMiOjF9.Q0QEquWWnnGHUo2DuBh-A0Lgvc07FHMHpnWZ61oeSs7sQ8_KQc4GXTG7_aYX6ymp-VQSxazR3VoA7jvfhDqehXdjFpRx5e05qTCWK5-yc_aKc7bvzbm7u-pW_IPfS0v8Y4c3xucbnsvUSufP_9BR1uA2H6dC3V9maltUo9WL2WM9KuQoSsYO3jrKG0MllZva4mF10TEfNQj3etvnLUqjhe5pjnbXl_QYdSEk4LVqlJWisdxfd3a89fWeVR5k1qZAhvbY_Rcnv0m1AKZF2zxO9A8S0MhJqKUO2Cr9nQPa6C0SJXeM8gc6Es9oQKp1xXo0yvhPc9RQ2Kn-QIFjVn1KOA')
 // client.gloabl.set('t', token)
# %}

GET http://localhost:8080/api/v1/credits/get-credits
Authorization: Bearer eyJraWQiOiIzMTFjZTViOC01ZWY4LTQ2ODQtOTc5Yi1hYTIyZWI4NWNmZmIiLCJhbGciOiJSUzI1NiJ9.eyJHSVRIVUJfbmFtZSI6IkhheWRlbiBSZWFyIiwic3ViIjoiaGF5ZGVucmVhciIsIkdJVEhVQl90b3RhbF9wcml2YXRlX3JlcG9zIjo0MSwiR0lUSFVCX3N0YXJyZWRfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL3N0YXJyZWR7L293bmVyfXsvcmVwb30iLCJHSVRIVUJfZm9sbG93ZXJzIjo4LCJHSVRIVUJfbm9kZV9pZCI6Ik1EUTZWWE5sY2pRME1EYzJOelEzIiwiR0lUSFVCX2h0bWxfdXJsIjoiaHR0cHM6Ly9naXRodWIuY29tL2hheWRlbnJlYXIiLCJHSVRIVUJfZm9sbG93aW5nIjoxNywiR0lUSFVCX3B1YmxpY19naXN0cyI6MCwiR0lUSFVCX2JpbyI6ImhlbGxvIiwiR0lUSFVCX2NvbGxhYm9yYXRvcnMiOjIsIkdJVEhVQl9pZCI6NDQwNzY3NDcsIkdJVEhVQl9mb2xsb3dpbmdfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL2ZvbGxvd2luZ3svb3RoZXJfdXNlcn0iLCJHSVRIVUJfaGlyZWFibGUiOnRydWUsInNjb3BlIjpbImFkZHJlc3MiLCJjbGllbnRJZCIsImNkYyIsInByZWZlcnJlZFVzZXJuYW1lIiwib3BlbmlkIiwicHJvZmlsZSIsInVzZXI6ZW1haWwiLCJwcmluY2lwYWxJZCIsInBob25lIiwicmVhZDp1c2VyIiwibmFtZSIsInVzZXIiLCJlbWFpbCIsInVzZXJuYW1lIl0sIkdJVEhVQl9vd25lZF9wcml2YXRlX3JlcG9zIjo0MSwiR0lUSFVCX2F2YXRhcl91cmwiOiJodHRwczovL2F2YXRhcnMuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3UvNDQwNzY3NDc_dj00IiwiR0lUSFVCX2V2ZW50c191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvZXZlbnRzey9wcml2YWN5fSIsIkdJVEhVQl9yZXBvc191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvcmVwb3MiLCJleHAiOjE3NjEwNjEwNzcsIkdJVEhVQl9ibG9nIjoiIiwiaWF0IjoxNzYxMDYwNzc3LCJqdGkiOiI5N2M5MWRhZC04ZjdhLTQ4ZjctYWYxNS1hNWE2NmFmMzMyODAiLCJHSVRIVUJfdHdvX2ZhY3Rvcl9hdXRoZW50aWNhdGlvbiI6dHJ1ZSwiR0lUSFVCX29yZ2FuaXphdGlvbnNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL29yZ3MiLCJHSVRIVUJfY3JlYXRlZF9hdCI6IjIwMTgtMTAtMTJUMDE6MzE6MDZaIiwiR0lUSFVCX2dyYXZhdGFyX2lkIjoiIiwiR0lUSFVCX3VzZXJfdmlld190eXBlIjoicHJpdmF0ZSIsIkdJVEhVQl9wbGFuIjp7Im5hbWUiOiJmcmVlIiwic3BhY2UiOjk3NjU2MjQ5OSwiY29sbGFib3JhdG9ycyI6MCwicHJpdmF0ZV9yZXBvcyI6MTAwMDB9LCJhdWQiOiJjZGMtb2F1dGgyLWNsaWVudCIsIkdJVEhVQl9sb2NhdGlvbiI6IkV1Z2VuZSwgT3JlZ29uIiwiR0lUSFVCX3B1YmxpY19yZXBvcyI6NzYsIm5iZiI6MTc2MTA2MDc3NywiR0lUSFVCX3VybCI6Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlcnMvaGF5ZGVucmVhciIsIkdJVEhVQl91cGRhdGVkX2F0IjoiMjAyNS0xMC0xM1QxNzoxOToyOFoiLCJHSVRIVUJfc3Vic2NyaXB0aW9uc191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvc3Vic2NyaXB0aW9ucyIsIkdJVEhVQl9yZWNlaXZlZF9ldmVudHNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL3JlY2VpdmVkX2V2ZW50cyIsIkdJVEhVQl9sb2dpbiI6ImhheWRlbnJlYXIiLCJHSVRIVUJfZ2lzdHNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL2dpc3Rzey9naXN0X2lkfSIsIkdJVEhVQl90eXBlIjoiVXNlciIsIkdJVEhVQl9kaXNrX3VzYWdlIjoyMzE4MzksIkdJVEhVQl9zaXRlX2FkbWluIjpmYWxzZSwiR0lUSFVCX2ZvbGxvd2Vyc191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvZm9sbG93ZXJzIiwiR0lUSFVCX3ByaXZhdGVfZ2lzdHMiOjF9.Q0QEquWWnnGHUo2DuBh-A0Lgvc07FHMHpnWZ61oeSs7sQ8_KQc4GXTG7_aYX6ymp-VQSxazR3VoA7jvfhDqehXdjFpRx5e05qTCWK5-yc_aKc7bvzbm7u-pW_IPfS0v8Y4c3xucbnsvUSufP_9BR1uA2H6dC3V9maltUo9WL2WM9KuQoSsYO3jrKG0MllZva4mF10TEfNQj3etvnLUqjhe5pjnbXl_QYdSEk4LVqlJWisdxfd3a89fWeVR5k1qZAhvbY_Rcnv0m1AKZF2zxO9A8S0MhJqKUO2Cr9nQPa6C0SJXeM8gc6Es9oQKp1xXo0yvhPc9RQ2Kn-QIFjVn1KOA
Content-Type: application/x-www-form-urlencoded

grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&client_id=Ov23li6AX6ixxIAZ8llp&client_secret=076f0af95dd8475ad790761ebad6575cf7aabd47

###
< {%
    var payload = `
{
  "id": "evt_3SK5cFRE2HMtvBnh0A0w8uyU",
  "object": "event",
  "api_version": "2025-09-30.clover",
  "created": 1760914940,
  "data": {
    "object": {
      "id": "pi_3SK5cFRE2HMtvBnh0Ahuc3vC",
      "object": "payment_intent",
      "amount": 2000,
      "amount_capturable": 0,
      "amount_details": {
        "tip": {}
      },
      "amount_received": 2000,
      "application": null,
      "application_fee_amount": null,
      "automatic_payment_methods": null,
      "canceled_at": null,
      "cancellation_reason": null,
      "capture_method": "automatic_async",
      "client_secret": "pi_3SK5cFRE2HMtvBnh0Ahuc3vC_secret_zFOVXxXhhMhNoJXfRpkeOYjUm",
      "confirmation_method": "automatic",
      "created": 1760914939,
      "currency": "usd",
      "customer": null,
      "description": "(created by Stripe CLI)",
      "excluded_payment_method_types": null,
      "last_payment_error": null,
      "latest_charge": "ch_3SK5cFRE2HMtvBnh0sHNfgH3",
      "livemode": false,
      "metadata": {},
      "next_action": null,
      "on_behalf_of": null,
      "payment_method": "pm_1SK5cFRE2HMtvBnhTiUYcVb1",
      "payment_method_configuration_details": null,
      "payment_method_options": {
        "card": {
          "installments": null,
          "mandate_options": null,
          "network": null,
          "request_three_d_secure": "automatic"
        }
      },
      "payment_method_types": [
        "card"
      ],
      "processing": null,
      "receipt_email": null,
      "review": null,
      "setup_future_usage": null,
      "shipping": {
        "address": {
          "city": "San Francisco",
          "country": "US",
          "line1": "510 Townsend St",
          "line2": null,
          "postal_code": "94103",
          "state": "CA"
        },
        "carrier": null,
        "name": "Jenny Rosen",
        "phone": null,
        "tracking_number": null
      },
      "source": null,
      "statement_descriptor": null,
      "statement_descriptor_suffix": null,
      "status": "succeeded",
      "transfer_data": null,
      "transfer_group": null
    }
  },
  "livemode": false,
  "pending_webhooks": 2,
  "request": {
    "id": "req_kPJ28yCeVhs9ni",
    "idempotency_key": "665a91f1-df7a-4582-bc7f-579f44301c9d"
  },
  "type": "payment_intent.succeeded"
}
 `

    var first = Date.now().toString()
    client.global.set("now", first)
    var t = crypto.hmac.sha256().withTextSecret("hello").updateWithText(first + "." + payload)
    client.global.set("sig", t.digest().toHex())
    client.global.set("p", payload)
%}
POST http://localhost:8080/api/v1/credits/stripe/add-credits
Content-Type: application/json
Stripe-Signature: v1=hello,t={{now}},v1={{sig}}

{{p}}
###
