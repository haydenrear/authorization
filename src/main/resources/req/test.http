### GET request to example server
# @no-cookie-jar
GET http://localhost:8080/userinfo
Authorization: Bearer eyJraWQiOiI2ZWI3ZjZhYS02ODcyLTQxOGItYjE1NS04M2JlNmM5NjE4MjQiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI0NDA3Njc0NyIsImdpc3RzX3VybCI6Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlcnMvaGF5ZGVucmVhci9naXN0c3svZ2lzdF9pZH0iLCJyZXBvc191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvcmVwb3MiLCJ1c2VyX3ZpZXdfdHlwZSI6InByaXZhdGUiLCJ0d29fZmFjdG9yX2F1dGhlbnRpY2F0aW9uIjp0cnVlLCJmb2xsb3dpbmdfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL2ZvbGxvd2luZ3svb3RoZXJfdXNlcn0iLCJpc3MiOiJsb2NhbGhvc3Q6ODA4MCIsImJpbyI6ImhlbGxvIiwiY3JlYXRlZF9hdCI6IjIwMTgtMTAtMTJUMDE6MzE6MDZaIiwiYmxvZyI6IiIsInR5cGUiOiJVc2VyIiwibG9naW4iOiJoYXlkZW5yZWFyIiwicHJpdmF0ZV9naXN0cyI6MSwidG90YWxfcHJpdmF0ZV9yZXBvcyI6NDEsInN1YnNjcmlwdGlvbnNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL3N1YnNjcmlwdGlvbnMiLCJ1cGRhdGVkX2F0IjoiMjAyNS0xMC0xM1QxNzoxOToyOFoiLCJzY29wZSI6WyJhZGRyZXNzIiwicGhvbmUiLCJvcGVuaWQiLCJyZWFkOnVzZXIiLCJwcm9maWxlIiwidXNlcjplbWFpbCIsInVzZXIiLCJlbWFpbCJdLCJzaXRlX2FkbWluIjpmYWxzZSwiZGlza191c2FnZSI6MjMxODM5LCJjb2xsYWJvcmF0b3JzIjoyLCJvd25lZF9wcml2YXRlX3JlcG9zIjo0MSwiaWQiOjQ0MDc2NzQ3LCJwdWJsaWNfcmVwb3MiOjc2LCJleHAiOjE3NjA5ODAyNDYsImlhdCI6MTc2MDk3OTk0NiwicGxhbiI6eyJuYW1lIjoiZnJlZSIsInNwYWNlIjo5NzY1NjI0OTksImNvbGxhYm9yYXRvcnMiOjAsInByaXZhdGVfcmVwb3MiOjEwMDAwfSwiZ3JhdmF0YXJfaWQiOiIiLCJqdGkiOiIwY2Y4NDFiMy1kZDVhLTQ1NjktOTM1My0wZDFkYmY2ODY5OTIiLCJvcmdhbml6YXRpb25zX3VybCI6Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlcnMvaGF5ZGVucmVhci9vcmdzIiwiaGlyZWFibGUiOnRydWUsInN0YXJyZWRfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL3N0YXJyZWR7L293bmVyfXsvcmVwb30iLCJmb2xsb3dlcnNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL2ZvbGxvd2VycyIsInB1YmxpY19naXN0cyI6MCwidXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyIiwiYXVkIjoiY2RjLW9hdXRoMi1jbGllbnQiLCJyZWNlaXZlZF9ldmVudHNfdXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy9oYXlkZW5yZWFyL3JlY2VpdmVkX2V2ZW50cyIsIm5iZiI6MTc2MDk3OTk0NiwiZm9sbG93ZXJzIjo4LCJhdmF0YXJfdXJsIjoiaHR0cHM6Ly9hdmF0YXJzLmdpdGh1YnVzZXJjb250ZW50LmNvbS91LzQ0MDc2NzQ3P3Y9NCIsImV2ZW50c191cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzL2hheWRlbnJlYXIvZXZlbnRzey9wcml2YWN5fSIsImh0bWxfdXJsIjoiaHR0cHM6Ly9naXRodWIuY29tL2hheWRlbnJlYXIiLCJmb2xsb3dpbmciOjE3LCJuYW1lIjoiSGF5ZGVuIFJlYXIiLCJsb2NhdGlvbiI6IkV1Z2VuZSwgT3JlZ29uIiwibm9kZV9pZCI6Ik1EUTZWWE5sY2pRME1EYzJOelEzIn0.LCR5IesA0nW_a5rdzgjej_N2Y0ec6dcjS7O8loU8czSWil1EHjICx3ui5p9BQzhZO7lanLo4zwljqSyj0vjbEHqaXVAwtQmegRtV3iTjflYBc3BLvaq4ppUwvg5Kq7Yq9zmUdeAcKgT5WA93FXw6EIS8av3XfM-l8tYB_FyzRBQJ92sh08TMirMvl_f2XJyWV9NYbSQ-gQgm-0qI33IXiUmqVd5P__0ykWQAgEj8104tLACpg3RRaK9q0av38L7WZqxtH_XGq4dW_VJYKAwlWKaRUGDZFPH9Zg3_QR3a_WIfuYlRG83guDhqT3SelQoXq4e62K7_I-t6XlMlRE3Oyw
Content-Type: application/x-www-form-urlencoded

grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&client_id=client&client_secret=secret

### GET request to example server
POST http://localhost:8080/oauth2/token
Authorization: Basic dXNlcjpwYXNzd29yZA==
Content-Type: application/x-www-form-urlencoded

grant_type=password&client_id=client&client_secret=secret

###

GET http://localhost:8080/api/v1/credits/get-credits
Authorization: Bearer eyJraWQiOiI2NDJhMmZiNy1iOTExLTRiMjYtOTI0NS02NTA2ODk4MDZjNDIiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI0NDA3Njc0NyIsImF1ZCI6ImNkYy1vYXV0aDItY2xpZW50IiwibmJmIjoxNzYwMTI0MjQ2LCJleHAiOjE3NjAxMjQ1NDYsImlhdCI6MTc2MDEyNDI0NiwianRpIjoiMjg2ZWZkYWQtYTRiOC00OGI2LTk0ZjEtYWY3OGE0MTk5NWI4In0.TmghsEv7X1A5CMAp3kkzHAMPsZvJ_fO1O19Jmzg7qOAEWmY8vQaWudULhEFLDsVASVNyJ3vQK9isAcou-_2bMy0XMR0F39CG9Lj36bW17QwDZRcVWvwReT_V89c8jq4IuKGvrwOtqQz8s-yMKFih9EkyxQe4q9K0UkigdDVFi33qsqA9BFOaT2LdQliAnPc8BBj0ok43cYvYiSOmPmcDEQJ2jIIKzhc8FJZBkrz7_Pr_BIyPZKt85huI72QL56WgO2Xkcb43paiA8Trklx_AEAiHbBlPfjJaEceQqW9q5kj8U27SjbxzH79zPEXA31PhpwvwZ_1KIRs1dKeHLjoVng
Content-Type: application/x-www-form-urlencoded

grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&client_id=cdc-oauth2-client&client_secret=234234lkjsldkdjfsd

###
< {%
    var payload = `
{
  "id": "evt_3SK5cFRE2HMtvBnh0A0w8uyU",
  "object": "event",
  "api_version": "2025-09-30.clover",
  "created": 1760914940,
  "data": {
    "object": {
      "id": "pi_3SK5cFRE2HMtvBnh0Ahuc3vC",
      "object": "payment_intent",
      "amount": 2000,
      "amount_capturable": 0,
      "amount_details": {
        "tip": {}
      },
      "amount_received": 2000,
      "application": null,
      "application_fee_amount": null,
      "automatic_payment_methods": null,
      "canceled_at": null,
      "cancellation_reason": null,
      "capture_method": "automatic_async",
      "client_secret": "pi_3SK5cFRE2HMtvBnh0Ahuc3vC_secret_zFOVXxXhhMhNoJXfRpkeOYjUm",
      "confirmation_method": "automatic",
      "created": 1760914939,
      "currency": "usd",
      "customer": null,
      "description": "(created by Stripe CLI)",
      "excluded_payment_method_types": null,
      "last_payment_error": null,
      "latest_charge": "ch_3SK5cFRE2HMtvBnh0sHNfgH3",
      "livemode": false,
      "metadata": {},
      "next_action": null,
      "on_behalf_of": null,
      "payment_method": "pm_1SK5cFRE2HMtvBnhTiUYcVb1",
      "payment_method_configuration_details": null,
      "payment_method_options": {
        "card": {
          "installments": null,
          "mandate_options": null,
          "network": null,
          "request_three_d_secure": "automatic"
        }
      },
      "payment_method_types": [
        "card"
      ],
      "processing": null,
      "receipt_email": null,
      "review": null,
      "setup_future_usage": null,
      "shipping": {
        "address": {
          "city": "San Francisco",
          "country": "US",
          "line1": "510 Townsend St",
          "line2": null,
          "postal_code": "94103",
          "state": "CA"
        },
        "carrier": null,
        "name": "Jenny Rosen",
        "phone": null,
        "tracking_number": null
      },
      "source": null,
      "statement_descriptor": null,
      "statement_descriptor_suffix": null,
      "status": "succeeded",
      "transfer_data": null,
      "transfer_group": null
    }
  },
  "livemode": false,
  "pending_webhooks": 2,
  "request": {
    "id": "req_kPJ28yCeVhs9ni",
    "idempotency_key": "665a91f1-df7a-4582-bc7f-579f44301c9d"
  },
  "type": "payment_intent.succeeded"
}
 `

    var first = Date.now().toString()
    client.global.set("now", first)
    var t = crypto.hmac.sha256().withTextSecret("hello").updateWithText(first + "." + payload)
    client.global.set("sig", t.digest().toHex())
    client.global.set("p", payload)
%}
POST http://localhost:8080/api/v1/credits/stripe/add-credits
Content-Type: application/json
Stripe-Signature: v1=hello,t={{now}},v1={{sig}}

{{p}}
###
